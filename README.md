# Async Notification System

–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ FastAPI —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π —á–µ—Ä–µ–∑ Email, SMS –∏ Telegram.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç ARQ –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á –∏ Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

---

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤: Email, SMS, Telegram.
* –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–∞–Ω–∞–ª–æ–≤: –µ—Å–ª–∏ –æ–¥–∏–Ω –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π.
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
* –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á.
* –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –¥—Ä—É–≥–∏–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

---

## üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* Python 3.11
* FastAPI
* ARQ
* Redis
* Async HTTP (httpx)
* PostgreSQL (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
* Docker & Docker Compose

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/BahaGit2002/notification_system
cd notification_system
```

2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

```env
REDIS_URL=redis://redis:6379/0
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
EMAIL_FROM=
TELEGRAM_BOT_TOKEN=
SMS_API_URL=dummy
SMS_API_KEY=api_key
```

3. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker-compose up --build
```

---

## üìå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/notify/`:

```json
{
  "user_id": 1,
  "email": "user@example.com",
  "phone": "+123456789",
  "telegram_id": "6860846832",
  "message": "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
  "channels_priority": ["telegram", "email", "sms"]
}
```

* `channels_priority` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.
* –°–∏—Å—Ç–µ–º–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–∞–Ω–∞–ª—É, –ø–æ–∫–∞ –Ω–µ –¥–æ–±—å—ë—Ç—Å—è —É—Å–ø–µ—Ö–∞.

---

### –ü—Ä–∏–º–µ—Ä cURL

```bash
curl -X POST http://localhost:8000/notify/ \
-H "Content-Type: application/json" \
-d '{
  "user_id": 1,
  "email": "user@example.com",
  "phone": "+123456789",
  "telegram_id": "6860846832",
  "message": "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ üëã",
  "channels_priority": ["telegram", "email", "sms"]
}'
```

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ main.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ workers.py           # ARQ –≤–æ—Ä–∫–µ—Ä
‚îú‚îÄ services/
‚îÇ  ‚îú‚îÄ base.py           # –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å AsyncNotificationService
‚îÇ  ‚îú‚îÄ telegram_service.py
‚îÇ  ‚îú‚îÄ email_service.py
‚îÇ  ‚îî‚îÄ sms_service.py
‚îú‚îÄ schemas.py           # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (Redis, Telegram, Email)
```

---

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

* –í –≤–æ—Ä–∫–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ logging –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏:

```python
import logging
logger = logging.getLogger("notification")
logger.info("Notification sent")
```

* –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –≤ Docker:

```bash
docker-compose logs -f worker
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

* –î–ª—è Telegram: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–¥–æ–ª–∂–µ–Ω –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑**. –ò–Ω–∞—á–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–∏—Ç—Å—è.
* SMS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–ª–∞—Ç–Ω—ã–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
* Email —Ç—Ä–µ–±—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ SMTP-–∫–æ–Ω—Ñ–∏–≥–∞.

---

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ª–µ–≥–∫–æ —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, –Ω–∞—Å–ª–µ–¥—É–µ–º–æ–≥–æ –æ—Ç `AsyncNotificationService`.
* –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –≤ PostgreSQL.

---

## üìö –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

* [FastAPI Documentation](https://fastapi.tiangolo.com/)
* [ARQ Documentation](https://arq-docs.helpmanual.io/)
* [Telegram Bot API](https://core.telegram.org/bots/api)
